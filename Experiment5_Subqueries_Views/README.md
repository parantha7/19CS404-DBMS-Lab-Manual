# Experiment 5: Subqueries and Views
# REG_NO : 212224040232

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

**Question 1**
--
Write a SQL query that retrieves the names of students and their corresponding grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

<img width="602" height="233" alt="image" src="https://github.com/user-attachments/assets/8729b6f2-5e20-42bd-99bd-1166d84c10c8" />


```sql
select student_name,grade
from grades g
where grade =(
select min(grade)
from grades
where subject = g.subject 
)
```

**Output:**

<img width="640" height="409" alt="image" src="https://github.com/user-attachments/assets/f4d31f30-76ba-4de5-98d3-ed56101e7640" />


**Question 2**
---
From the following tables, write a SQL query to find all orders generated by the salespeople who may work for customers whose id is 3007. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

Table Name: orders
```
name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
```

```sql
select * from orders
where salesman_id=(
select salesman_id
from orders
where customer_id=3007
)
```

**Output:**

<img width="1000" height="399" alt="image" src="https://github.com/user-attachments/assets/43bba721-6df9-4086-b1d2-58b09f54af92" />

**Question 3**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $1500.

Sample table: CUSTOMERS
```
ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000 
```

```sql
select * from customers
where salary > 1500
```

**Output:**

<img width="963" height="541" alt="image" src="https://github.com/user-attachments/assets/93339ec8-dfce-42e1-9452-971836069ea2" />


**Question 4**
---
Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.

SAMPLE TABLE: customer
```
name             type
---------------  ---------------
id               INTEGER
name             TEXT
city             TEXT
email            TEXT
phone            INTEGER
```

```sql
select name
from customer
where phone in (

select phone
from customer
group by phone
having count(*) =1
)
```


**Output:**

<img width="405" height="424" alt="image" src="https://github.com/user-attachments/assets/83da4351-c697-4f02-9bbf-573a22f86e18" />


**Question 5**
---
Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

<img width="602" height="233" alt="image" src="https://github.com/user-attachments/assets/109b8433-e0ff-415b-9953-fddab1208226" />

```sql
select * from grades g
where grade = (
select min(grade)
from grades
where subject = g.subject

)
```

**Output:**

<img width="1088" height="411" alt="image" src="https://github.com/user-attachments/assets/8c416651-81ec-4012-b961-8e2a844a69da" />

**Question 6**
---
Write a SQL query to List departments with names longer than the average length

Departments Table (attributes: department_id, department_name)

<img width="866" height="134" alt="image" src="https://github.com/user-attachments/assets/9f9ecb87-14b7-49b7-928f-59c62e91fd38" />


```sql
select department_id  as depar,department_name
from departments
where length(department_name) > (
select avg(length(department_name)) 
from departments

)
```

**Output:**

<img width="536" height="384" alt="image" src="https://github.com/user-attachments/assets/db08483b-4047-4d6e-b7bb-46df9d3a56b4" />

**Question 7**
---
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 2.5 Lakh

Employee Table
```
name             type

------------   ---------------

id                    INTEGER

name              TEXT

age                 INTEGER

city                 TEXT

income           INTEGER
```

```sql
select * from employee
where age < (
select avg(age)
from employee
where income > 250000
)
```

**Output:**

<img width="1126" height="463" alt="image" src="https://github.com/user-attachments/assets/e6d2516b-e266-410b-9c0f-f90200b711be" />


**Question 8**
---
Write a SQL query that retrieve all the columns from the table "Grades", where the grade is equal to the maximum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)

<img width="602" height="233" alt="image" src="https://github.com/user-attachments/assets/de53dba8-6a1f-471d-885d-97555e948931" />

```sql
select * from grades g
where grade =(
select max(grade)
from grades
where subject = g.subject 
)
```

**Output:**

<img width="1106" height="407" alt="image" src="https://github.com/user-attachments/assets/b1c7483b-dce4-467a-839f-6725c73d726b" />

**Question 9**
---
Write a query to display all the customers whose ID is the difference between the salesperson ID of Mc Lyon and 2001.
```
salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

customer table

name         type
-----------  ----------
customer_id  int
cust_name    text
city         text
grade        int
salesman_id  int
```
```sql
SELECT 
    customer_id,
    cust_name,
    city,
    grade,
    salesman_id
FROM 
    customer
WHERE 
    customer_id = (
        (SELECT salesman_id FROM salesman WHERE name = 'Mc Lyon') - 2001
    );
```

**Output:**

<img width="1031" height="304" alt="image" src="https://github.com/user-attachments/assets/e07a10a1-1f4b-4263-adb4-a1e26fa112b4" />


**Question 10**
---
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.
```
Sample table: CUSTOMERS

ID          NAME        AGE         ADDRESS     SALARY
----------  ----------  ----------  ----------  ----------

1          Ramesh     32              Ahmedabad     2000
2          Khilan        25              Delhi                 1500
3          Kaushik      23              Kota                  2000
4          Chaitali       25             Mumbai            6500
5          Hardik        27              Bhopal              8500
6          Komal         22              Hyderabad       4500

7           Muffy          24              Indore            10000
```

```sql
select * from customers
where salary  > 4500
```

**Output:**

<img width="1005" height="404" alt="image" src="https://github.com/user-attachments/assets/2fd4d244-47f1-4451-98ce-ee37fa5c79f9" />


## RESULT
Thus, the SQL queries to implement subqueries and views have been executed successfully.
